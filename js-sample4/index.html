<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<title>WebVTT Demo</title>
<style>
.with-caption {
  box-sizing: border-box;
  width: 500px;
  border: 3px solid tomato;
}
.with-caption::cue { font-size: 18px; }
.desc {
  margin-top: 10px;
  margin-bottom: 13px;
  font-size: 14px;
}
.view {
  box-sizing: border-box;
  width: 500px;
  height: 150px;
  padding: 10px;
  border: 3px solid #ccc;
  overflow: auto;
}
.view ol {
  margin: 10px 0;
  font-size: 14px;
}
.waiting {
  color: #ccc;
}
.copyright {
  margin-top: 15px;
  font-size: 12px;
}
</style>
<script>
  window.addEventListener('DOMContentLoaded', init, false);

  function init() {
    var sfx = new Audio('../assets/sound.mp3');
    var sounds = sfx.addTextTrack('metadata');
    // éŸ³æºã®å†ç”Ÿé–‹å§‹ãŒå¯èƒ½ã«ãªã£ãŸã¨ã
    sfx.addEventListener('loadeddata', enableButtons, false);

    // ãã‚Œãã‚Œã®éŸ³å£°ã®é–‹å§‹æ™‚é–“ã€çµ‚äº†æ™‚é–“ã€ã‚­ãƒ¥ãƒ¼IDã‚’ç™»éŒ²ã™ã‚‹
    sounds.addCue(createCue(0, 0.3, 'dog'));
    sounds.addCue(createCue(0.5, 1.8, 'bird'));
    sounds.addCue(createCue(2.0, 3.5, 'tiger'));

    // ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ãŸã‚‰ã€æŒ‡å®šã—ãŸIDã®éŸ³å£°ã‚’å†ç”Ÿã™ã‚‹
    document.querySelectorAll('.btn').forEach(function(btn) {
      btn.addEventListener('click', function () {
        playById(this.id);
      }, false);
    });

    // ãƒ­ãƒ¼ãƒ‰å®Œäº†å¾Œã«ãƒœã‚¿ãƒ³ã‚’æœ‰åŠ¹ã«ã™ã‚‹
    function enableButtons () {
      document.querySelectorAll('.btn').forEach(function(btn){
        btn.disabled = false;
      });
    };

    // åŠ¹æœéŸ³ã‚’è¿½åŠ ã™ã‚‹
    function createCue (start, end, id) {
      // ã‚­ãƒ¥ãƒ¼ã®é–‹å§‹æ™‚é–“, ã‚­ãƒ¥ãƒ¼ã®çµ‚äº†æ™‚é–“, ã‚­ãƒ¥ãƒ¼ãƒ†ã‚­ã‚¹ãƒˆ
      var cue = new VTTCue(start, end, '');
      // ã‚­ãƒ¥ãƒ¼ã«IDã‚’é™ã‚‹
      cue.id = id;
      // ã‚­ãƒ¥ãƒ¼ãŒçµ‚äº†ã—ãŸã‚‰åœæ­¢ã™ã‚‹
      cue.pauseOnExit = true;
      return cue;
    };

    // æŒ‡å®šã—ãŸã‚­ãƒ¥ãƒ¼IDã‚’å†ç”Ÿã™ã‚‹
    function playById (id) {
      console.log(sounds);
      // å†ç”Ÿã—ãŸã„ã‚­ãƒ¥ãƒ¼ã‚’å–å¾—ã™ã‚‹
      var selectedCue = sounds.cues.getCueById(id);
      // å†ç”Ÿã—ãŸã„ã‚­ãƒ¥ãƒ¼ã®startTimeã‚’å–å¾—ã—ã€éŸ³å£°ã®å†ç”Ÿé–‹å§‹ä½ç½®ã«ã™ã‚‹
      sfx.currentTime = selectedCue.startTime;
      sfx.play();
    };
  };
</script>
</head>
<body>
ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨éŸ³å£°ãŒæµã‚Œã¾ã™ã€‚
<div>
  <button type="button" disabled class="btn" id="dog">çŠ¬ã®é³´ãå£° ğŸ¶</button>
  <button type="button" disabled class="btn" id="bird">é³¥ã®é³´ãå£° ğŸ¦</button>
  <button type="button" disabled class="btn" id="tiger">è™ã®é³´ãå£° ğŸ¯</button>
</div>
<div class="copyright">
  éŸ³æºã¯<a href="http://maoudamashii.jokersounds.com/" title="ãƒ•ãƒªãƒ¼éŸ³æ¥½ç´ æ/é­”ç‹é­‚" target="_blank" rel="noopener noreferrer">ãƒ•ãƒªãƒ¼éŸ³æ¥½ç´ æ/é­”ç‹é­‚</a>ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚
</div>
</body>
</html>
